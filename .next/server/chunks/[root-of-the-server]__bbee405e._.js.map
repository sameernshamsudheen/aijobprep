{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/data/env/server.ts"],"sourcesContent":["import { createEnv } from \"@t3-oss/env-nextjs\";\nimport { z } from \"zod\";\n\nexport const serverEnv = createEnv({\n  server: {\n    CLERK_SECRET_KEY: z.string().min(1),\n    ARCJET_KEY: z.string().min(1),\n    POSTGRES_DB: z.string().min(1),\n    POSTGRES_USER: z.string().min(1),\n    POSTGRES_PASSWORD: z.string().min(1),\n    POSTGRES_PORT: z.string().min(1),\n    POSTGRES_HOST: z.string().min(1),\n    POSTGRES_HOSTNAME: z.string().min(1),\n    HUME_API_KEY: z.string().min(1),\n    HUME_SECRET_KEY: z.string().min(1),\n    GEMINI_API_KEY: z.string().min(1),\n  },\n\n  createFinalSchema:env=>{\n    return z.object(env).transform(val=>{\n      const {POSTGRES_HOST,POSTGRES_DB,POSTGRES_PASSWORD,POSTGRES_PORT,POSTGRES_USER,...rest} =val\n      return{\n        ...rest,\n         DATABSE_URL:`postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}`\n      }\n    })\n  },\n  experimental__runtimeEnv: process.env,\n  emptyStringAsUndefined: true,\n});\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,MAAM,YAAY,IAAA,4KAAS,EAAC;IACjC,QAAQ;QACN,kBAAkB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACjC,YAAY,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC3B,aAAa,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC5B,eAAe,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC9B,mBAAmB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAClC,eAAe,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC9B,eAAe,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC9B,mBAAmB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAClC,cAAc,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC7B,iBAAiB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAChC,gBAAgB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACjC;IAEA,mBAAkB,CAAA;QAChB,OAAO,yKAAC,CAAC,MAAM,CAAC,KAAK,SAAS,CAAC,CAAA;YAC7B,MAAM,EAAC,aAAa,EAAC,WAAW,EAAC,iBAAiB,EAAC,aAAa,EAAC,aAAa,EAAC,GAAG,MAAK,GAAE;YACzF,OAAM;gBACJ,GAAG,IAAI;gBACN,aAAY,CAAC,WAAW,EAAE,cAAc,CAAC,EAAE,kBAAkB,CAAC,EAAE,cAAc,CAAC,EAAE,cAAc,CAAC,EAAE,aAAa;YAClH;QACF;IACF;IACA,0BAA0B,QAAQ,GAAG;IACrC,wBAAwB;AAC1B","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema-helpers.ts"],"sourcesContent":["import { timestamp, uuid } from \"drizzle-orm/pg-core\";\nexport const uuidId = {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n};\nexport const timestamps = {\n  createdAt: timestamp(\"created_at\", { withTimezone: true })\n    .defaultNow()\n    .notNull(),\n  updatedAt: timestamp(\"updated_at\", { withTimezone: true })\n    .defaultNow()\n    .notNull()\n    .$onUpdate(() => new Date()),\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AACO,MAAM,SAAS;IACpB,IAAI,IAAA,yKAAI,EAAC,MAAM,aAAa,GAAG,UAAU;AAC3C;AACO,MAAM,aAAa;IACxB,WAAW,IAAA,mLAAS,EAAC,cAAc;QAAE,cAAc;IAAK,GACrD,UAAU,GACV,OAAO;IACV,WAAW,IAAA,mLAAS,EAAC,cAAc;QAAE,cAAc;IAAK,GACrD,UAAU,GACV,OAAO,GACP,SAAS,CAAC,IAAM,IAAI;AACzB","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema/interviews.ts"],"sourcesContent":["import { relations } from \"drizzle-orm\";\nimport { pgTable, uuid, varchar } from \"drizzle-orm/pg-core\";\n\nimport { timestamps, uuidId } from \"../schema-helpers\";\nimport { JobInfoTable } from \"./job-info\";\n\nexport const InterviewsTable = pgTable(\"interviews\", {\n  ...uuidId,\n  jobInfoId: uuid(\"job_info_id\")\n    .notNull()\n    .references(() => JobInfoTable.id, { onDelete: \"cascade\" }),\n  duration: varchar(\"duration\", { length: 255 }).notNull(),\n  humeChatId: varchar(\"hume_chat_id\", { length: 255 }).notNull(),\n  feedback: varchar(\"feedback\", { length: 2000 }),\n  ...timestamps,\n});\n\nexport const interviewRelations = relations(InterviewsTable, ({ one }) => ({\n  jobInfo: one(JobInfoTable, {\n    fields: [InterviewsTable.jobInfoId],\n    references: [JobInfoTable.id],\n  }),\n}));\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAAA;AAEA;AACA;;;;;AAEO,MAAM,kBAAkB,IAAA,kKAAO,EAAC,cAAc;IACnD,GAAG,+IAAM;IACT,WAAW,IAAA,yKAAI,EAAC,eACb,OAAO,GACP,UAAU,CAAC,IAAM,yJAAY,CAAC,EAAE,EAAE;QAAE,UAAU;IAAU;IAC3D,UAAU,IAAA,+KAAO,EAAC,YAAY;QAAE,QAAQ;IAAI,GAAG,OAAO;IACtD,YAAY,IAAA,+KAAO,EAAC,gBAAgB;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC5D,UAAU,IAAA,+KAAO,EAAC,YAAY;QAAE,QAAQ;IAAK;IAC7C,GAAG,mJAAU;AACf;AAEO,MAAM,qBAAqB,IAAA,0JAAS,EAAC,iBAAiB,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACzE,SAAS,IAAI,yJAAY,EAAE;YACzB,QAAQ;gBAAC,gBAAgB,SAAS;aAAC;YACnC,YAAY;gBAAC,yJAAY,CAAC,EAAE;aAAC;QAC/B;IACF,CAAC","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema/questions.ts"],"sourcesContent":["import { pgEnum, pgTable, uuid, varchar } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\n\nimport { timestamps, uuidId } from \"../schema-helpers\";\nimport { JobInfoTable } from \"./job-info\";\n\nexport const questionDifficultyOptions = [\n  \"easy\",\n  \"medium\",\n  \"hard\",\n] as const;\n\nexport const questionDifficultyEnum = pgEnum(\n  \"question_difficulty\",\n  questionDifficultyOptions\n);\n\nexport const QuestionsTable = pgTable(\"questions\", {\n  ...uuidId,\n  jobInfoId: uuid(\"job_info_id\")\n    .notNull()\n    .references(() => JobInfoTable.id, { onDelete: \"cascade\" }),\n  text: varchar(\"text\", { length: 2000 }).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  difficulty: questionDifficultyEnum(\"difficulty\").notNull(),\n  ...timestamps,\n});\nexport const questionsRelations = relations(QuestionsTable, ({ one }) => ({\n  JobInfo: one(JobInfoTable, {\n    fields: [QuestionsTable.jobInfoId],\n    references: [JobInfoTable.id],\n  }),\n}));"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;;;;;AAEO,MAAM,4BAA4B;IACvC;IACA;IACA;CACD;AAEM,MAAM,yBAAyB,IAAA,2KAAM,EAC1C,uBACA;AAGK,MAAM,iBAAiB,IAAA,kKAAO,EAAC,aAAa;IACjD,GAAG,+IAAM;IACT,WAAW,IAAA,yKAAI,EAAC,eACb,OAAO,GACP,UAAU,CAAC,IAAM,yJAAY,CAAC,EAAE,EAAE;QAAE,UAAU;IAAU;IAC3D,MAAM,IAAA,+KAAO,EAAC,QAAQ;QAAE,QAAQ;IAAK,GAAG,OAAO;IAC/C,MAAM,IAAA,+KAAO,EAAC,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC9C,YAAY,uBAAuB,cAAc,OAAO;IACxD,GAAG,mJAAU;AACf;AACO,MAAM,qBAAqB,IAAA,0JAAS,EAAC,gBAAgB,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACxE,SAAS,IAAI,yJAAY,EAAE;YACzB,QAAQ;gBAAC,eAAe,SAAS;aAAC;YAClC,YAAY;gBAAC,yJAAY,CAAC,EAAE;aAAC;QAC/B;IACF,CAAC","debugId":null}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema/job-info.ts"],"sourcesContent":["import { relations } from \"drizzle-orm\";\n\nimport { pgEnum, pgTable, varchar } from \"drizzle-orm/pg-core\";\n\nimport { timestamps, uuidId } from \"../schema-helpers\";\nimport { UserTable } from \"./user\";\nimport { InterviewsTable } from \"./interviews\";\nimport { QuestionsTable } from \"./questions\";\n\nexport const experienceLevelOptions = [\n  \"junior\",\n  \"mid-level\",\n  \"senior\",\n] as const;\n\nexport const experienceLevelEnum = pgEnum(\n  \"experience_level\",\n  experienceLevelOptions\n);\n\nexport const JobInfoTable = pgTable(\"job_infos\", {\n  ...uuidId,\n  userId: varchar(\"user_id\", { length: 255 })\n    .notNull()\n    .references(() => UserTable.id, { onDelete: \"cascade\" }),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n   description: varchar().notNull(),\n  experienceLevel: experienceLevelEnum(\"experience_level\").notNull(),\n  ...timestamps,\n});\n\nexport const jobInfoRelations = relations(JobInfoTable, ({ one, many }) => ({\n  user: one(UserTable, {\n    fields: [JobInfoTable.userId],\n    references: [UserTable.id],\n  }),\n  questions:many(QuestionsTable),\n  interviews: many(InterviewsTable),\n}));\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AACA;;;;;;;AAEO,MAAM,yBAAyB;IACpC;IACA;IACA;CACD;AAEM,MAAM,sBAAsB,IAAA,2KAAM,EACvC,oBACA;AAGK,MAAM,eAAe,IAAA,kKAAO,EAAC,aAAa;IAC/C,GAAG,+IAAM;IACT,QAAQ,IAAA,+KAAO,EAAC,WAAW;QAAE,QAAQ;IAAI,GACtC,OAAO,GACP,UAAU,CAAC,IAAM,+IAAS,CAAC,EAAE,EAAE;QAAE,UAAU;IAAU;IACxD,OAAO,IAAA,+KAAO,EAAC,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,MAAM,IAAA,+KAAO,EAAC,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC7C,aAAa,IAAA,+KAAO,IAAG,OAAO;IAC/B,iBAAiB,oBAAoB,oBAAoB,OAAO;IAChE,GAAG,mJAAU;AACf;AAEO,MAAM,mBAAmB,IAAA,0JAAS,EAAC,cAAc,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,GAAK,CAAC;QAC1E,MAAM,IAAI,+IAAS,EAAE;YACnB,QAAQ;gBAAC,aAAa,MAAM;aAAC;YAC7B,YAAY;gBAAC,+IAAS,CAAC,EAAE;aAAC;QAC5B;QACA,WAAU,KAAK,yJAAc;QAC7B,YAAY,KAAK,2JAAe;IAClC,CAAC","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema/user.ts"],"sourcesContent":["import { relations } from \"drizzle-orm\";\nimport { pgTable, varchar } from \"drizzle-orm/pg-core\";\n\nimport { timestamps } from \"../schema-helpers\";\nimport { JobInfoTable } from \"./job-info\";\n\nexport const UserTable = pgTable(\"users\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  imageUrl: varchar(\"image_url\", { length: 2048 }).notNull(),\n  email: varchar(\"email\", { length: 255 }).notNull().unique(),\n  ...timestamps,\n});\n\nexport const userRelations = relations(UserTable, ({ many }) => ({\n  jobInfos: many(JobInfoTable),\n}));\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAEA;AACA;;;;;AAEO,MAAM,YAAY,IAAA,kKAAO,EAAC,SAAS;IACxC,IAAI,IAAA,+KAAO,EAAC,MAAM;QAAE,QAAQ;IAAI,GAAG,UAAU;IAC7C,MAAM,IAAA,+KAAO,EAAC,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC9C,UAAU,IAAA,+KAAO,EAAC,aAAa;QAAE,QAAQ;IAAK,GAAG,OAAO;IACxD,OAAO,IAAA,+KAAO,EAAC,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO,GAAG,MAAM;IACzD,GAAG,mJAAU;AACf;AAEO,MAAM,gBAAgB,IAAA,0JAAS,EAAC,WAAW,CAAC,EAAE,IAAI,EAAE,GAAK,CAAC;QAC/D,UAAU,KAAK,yJAAY;IAC7B,CAAC","debugId":null}},
    {"offset": {"line": 308, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/schema.ts"],"sourcesContent":["export * from \"./schema/user\";\nexport * from \"./schema/job-info\";\nexport * from \"./schema/questions\";\nexport * from \"./schema/interviews\";\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA","debugId":null}},
    {"offset": {"line": 376, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/drizzle/db.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { Pool } from \"pg\";\n\nimport { serverEnv } from \"@/data/env/server\";\nimport * as schema from \"./schema\";\n\nconst pool = new Pool({\n  connectionString: serverEnv.DATABSE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n"],"names":[],"mappings":";;;AAAA;AACA;AAEA;AACA;AAAA;;;;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,2IAAS,CAAC,WAAW;AACzC;AAEO,MAAM,KAAK,IAAA,yKAAO,EAAC,MAAM;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/ai/models/google.ts"],"sourcesContent":["import { serverEnv} from \"@/data/env/server\"\nimport { createGoogleGenerativeAI } from \"@ai-sdk/google\"\n\nexport const google = createGoogleGenerativeAI({\n  apiKey: serverEnv.GEMINI_API_KEY,\n})"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,MAAM,SAAS,IAAA,qLAAwB,EAAC;IAC7C,QAAQ,2IAAS,CAAC,cAAc;AAClC","debugId":null}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/ai/questions.ts"],"sourcesContent":["import {\n  JobInfoTable,\n  questionDifficultyEnum,\n  QuestionsTable,\n} from \"@/drizzle/schema\"\nimport { CoreMessage, streamText } from \"ai\"\nimport { google } from \"./models/google\"\n\nexport function generateAiQuestion({\n  jobInfo,\n  previousQuestions,\n  difficulty,\n  onFinish,\n}: {\n  jobInfo: Pick<\n    typeof JobInfoTable.$inferSelect,\n    \"title\" | \"description\" | \"experienceLevel\"\n  >\n  previousQuestions: Pick<\n    typeof QuestionsTable.$inferSelect,\n    \"text\" | \"difficulty\"\n  >[]\n  difficulty: QuestionDifficulty\n  onFinish: (question: string) => void\n}) {\n  const previousMessages = previousQuestions.flatMap(\n    q =>\n      [\n        { role: \"user\", content: q.difficulty },\n        { role: \"assistant\", content: q.text },\n      ] satisfies CoreMessage[]\n  )\n\n  return streamText({\n    model: google(\"gemini-2.5-flash\"),\n    onFinish: ({ text }) => onFinish(text),\n    messages: [\n      ...previousMessages,\n      {\n        role: \"user\",\n        content: difficulty,\n      },\n    ],\n    maxSteps: 10,\n    experimental_continueSteps: true,\n    system: `You are an AI assistant that creates technical interview questions tailored to a specific job role. Your task is to generate one **realistic and relevant** technical question that matches the skill requirements of the job and aligns with the difficulty level provided by the user.\n\nJob Information:\n- Job Description: \\`${jobInfo.description}\\`\n- Experience Level: \\`${jobInfo.experienceLevel}\\`\n${jobInfo.title ? `\\n- Job Title: \\`${jobInfo.title}\\`` : \"\"}\n\nGuidelines:\n- The question must reflect the skills and technologies mentioned in the job description.\n- Make sure the question is appropriately scoped for the specified experience level.\n- A difficulty level of \"easy\", \"medium\", or \"hard\" is provided by the user and should be used to tailor the question.\n- Prefer practical, real-world challenges over trivia.\n- Return only the question, clearly formatted (e.g., with code snippets or bullet points if needed). Do not include the answer.\n- Return only one question at a time.\n- It is ok to ask a question about just a single part of the job description, such as a specific technology or skill (e.g., if the job description is for a Next.js, Drizzle, and TypeScript developer, you can ask a TypeScript only question).\n- The question should be formatted as markdown.\n- Stop generating output as soon you have provided the full question.`,\n  })\n}\n\nexport function generateAiQuestionFeedback({\n  question,\n  answer,\n}: {\n  question: string\n  answer: string\n}) {\n  return streamText({\n    model: google(\"gemini-2.5-flash\"),\n    prompt: answer,\n    maxSteps: 10,\n    experimental_continueSteps: true,\n    system: `You are an expert technical interviewer. Your job is to evaluate the candidate's answer to a technical interview question.\n\nThe original question was:\n\\`\\`\\`\n${question}\n\\`\\`\\`\n\nInstructions:\n- Review the candidate's answer (provided in the user prompt).\n- Assign a rating from **1 to 10**, where:\n  - 10 = Perfect, complete, and well-articulated\n  - 7-9 = Mostly correct, with minor issues or room for optimization\n  - 4-6 = Partially correct or incomplete\n  - 1-3 = Largely incorrect or missing the point\n- Provide **concise, constructive feedback** on what was done well and what could be improved.\n- Be honest but professional.\n- Include a full correct answer in the output. Do not use this answer as part of the grading. Only look at the candidate's response when assigning a rating.\n- Try to generate a concise answer where possible, but do not sacrifice quality for brevity.\n- Refer to the candidate as \"you\" in your feedback. This feedback should be written as if you were speaking directly to the interviewee.\n- Stop generating output as soon you have provided the rating, feedback, and full correct answer.\n\nOutput Format (strictly follow this structure):\n\\`\\`\\`\n## Feedback (Rating: <Your rating from 1 to 10>/10)\n<Your written feedback as markdown>\n---\n## Correct Answer\n<The full correct answer as markdown>\n\\`\\`\\``,\n  })\n}"],"names":[],"mappings":";;;;AAKA;AACA;;;AAEO,SAAS,mBAAmB,EACjC,OAAO,EACP,iBAAiB,EACjB,UAAU,EACV,QAAQ,EAYT;IACC,MAAM,mBAAmB,kBAAkB,OAAO,CAChD,CAAA,IACE;YACE;gBAAE,MAAM;gBAAQ,SAAS,EAAE,UAAU;YAAC;YACtC;gBAAE,MAAM;gBAAa,SAAS,EAAE,IAAI;YAAC;SACtC;IAGL,OAAO,IAAA,oKAAU,EAAC;QAChB,OAAO,IAAA,qJAAM,EAAC;QACd,UAAU,CAAC,EAAE,IAAI,EAAE,GAAK,SAAS;QACjC,UAAU;eACL;YACH;gBACE,MAAM;gBACN,SAAS;YACX;SACD;QACD,UAAU;QACV,4BAA4B;QAC5B,QAAQ,CAAC;;;qBAGQ,EAAE,QAAQ,WAAW,CAAC;sBACrB,EAAE,QAAQ,eAAe,CAAC;AAChD,EAAE,QAAQ,KAAK,GAAG,CAAC,iBAAiB,EAAE,QAAQ,KAAK,CAAC,EAAE,CAAC,GAAG,GAAG;;;;;;;;;;;qEAWQ,CAAC;IACpE;AACF;AAEO,SAAS,2BAA2B,EACzC,QAAQ,EACR,MAAM,EAIP;IACC,OAAO,IAAA,oKAAU,EAAC;QAChB,OAAO,IAAA,qJAAM,EAAC;QACd,QAAQ;QACR,UAAU;QACV,4BAA4B;QAC5B,QAAQ,CAAC;;;;AAIb,EAAE,SAAS;;;;;;;;;;;;;;;;;;;;;;;;MAwBL,CAAC;IACL;AACF","debugId":null}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/lib/dataCache.ts"],"sourcesContent":["type CacheTag = \"users\" | \"jobInfos\" | \"interviews\" | \"questions\"\n\nexport function getGlobalTag(tag: CacheTag) {\n  return `global:${tag}` as const\n}\n\nexport function getUserTag(tag: CacheTag, userId: string) {\n  return `user:${userId}:${tag}` as const\n}\n\nexport function getJobInfoTag(tag: CacheTag, jobInfoId: string) {\n  return `jobInfo:${jobInfoId}:${tag}` as const\n}\n\nexport function getIdTag(tag: CacheTag, id: string) {\n  return `id:${id}:${tag}` as const\n}"],"names":[],"mappings":";;;;;;AAEO,SAAS,aAAa,GAAa;IACxC,OAAO,CAAC,OAAO,EAAE,KAAK;AACxB;AAEO,SAAS,WAAW,GAAa,EAAE,MAAc;IACtD,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,KAAK;AAChC;AAEO,SAAS,cAAc,GAAa,EAAE,SAAiB;IAC5D,OAAO,CAAC,QAAQ,EAAE,UAAU,CAAC,EAAE,KAAK;AACtC;AAEO,SAAS,SAAS,GAAa,EAAE,EAAU;IAChD,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,KAAK;AAC1B","debugId":null}},
    {"offset": {"line": 571, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/users/dbCache.ts"],"sourcesContent":["import { getGlobalTag, getIdTag } from \"../../lib/dataCache\"\nimport { revalidateTag } from \"next/cache\"\n\nexport function getUserGlobalTag() {\n  return getGlobalTag(\"users\")\n}\n\nexport function getUserIdTag(id: string) {\n  return getIdTag(\"users\", id)\n}\n\nexport function revalidateUserCache(id: string) {\n  revalidateTag(getUserGlobalTag())\n  revalidateTag(getUserIdTag(id))\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;AAEO,SAAS;IACd,OAAO,IAAA,yIAAY,EAAC;AACtB;AAEO,SAAS,aAAa,EAAU;IACrC,OAAO,IAAA,qIAAQ,EAAC,SAAS;AAC3B;AAEO,SAAS,oBAAoB,EAAU;IAC5C,IAAA,gJAAa,EAAC;IACd,IAAA,gJAAa,EAAC,aAAa;AAC7B","debugId":null}},
    {"offset": {"line": 612, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/lib/getcurrentUser.ts"],"sourcesContent":["import { db } from \"@/drizzle/db\"\nimport { UserTable } from \"@/drizzle/schema\"\nimport { getUserIdTag } from \"@/features/users/dbCache\"\nimport { auth } from \"@clerk/nextjs/server\"\nimport { eq } from \"drizzle-orm\"\nimport { cacheTag } from \"next/dist/server/use-cache/cache-tag\"\n\nexport async function getCurrentUser({ allData = false } = {}) {\n  const { userId, redirectToSignIn } = await auth()\n\n  return {\n    userId,\n    redirectToSignIn,\n    user: allData && userId != null ? await getUser(userId) : undefined,\n  }\n}\n\nasync function getUser(id: string) {\n  \"use cache\"\n  cacheTag(getUserIdTag(id))\n\n  return db.query.UserTable.findFirst({\n    where: eq(UserTable.id, id),\n  })\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AAEO,eAAe,eAAe,EAAE,UAAU,KAAK,EAAE,GAAG,CAAC,CAAC;IAC3D,MAAM,EAAE,MAAM,EAAE,gBAAgB,EAAE,GAAG,MAAM,IAAA,6LAAI;IAE/C,OAAO;QACL;QACA;QACA,MAAM,WAAW,UAAU,OAAO,MAAM,QAAQ,UAAU;IAC5D;AACF;IAEA,+SAAA,eAAe,QAAQ,EAAU;IAE/B,IAAA,oLAAQ,EAAC,IAAA,qJAAY,EAAC;IAEtB,OAAO,4HAAE,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;QAClC,OAAO,IAAA,0KAAE,EAAC,+IAAS,CAAC,EAAE,EAAE;IAC1B;AACF;;;;;;IAPe","debugId":null}},
    {"offset": {"line": 664, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/api/ai/questions/generate-feedback/route.ts"],"sourcesContent":["import { db } from \"@/drizzle/db\"\nimport { JobInfoTable, QuestionsTable } from \"@/drizzle/schema\"\nimport { generateAiQuestionFeedback } from \"@/services/ai/questions\"\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { createDataStreamResponse } from \"ai\"\nimport { eq } from \"drizzle-orm\"\nimport z from \"zod\"\n\nconst schema = z.object({\n  prompt: z.string().min(1),\n  questionId: z.string().min(1),\n})\n\nexport async function POST(req: Request) {\n  const body = await req.json()\n  const result = schema.safeParse(body)\n\n  if (!result.success) {\n    return new Response(\"Error generating your feedback\", { status: 400 })\n  }\n\n  const { prompt: answer, questionId } = result.data\n  const { userId } = await getCurrentUser()\n\n  if (userId == null) {\n    return new Response(\"You are not logged in\", { status: 401 })\n  }\n\n  const question = await getQuestion(questionId)\n  if (question == null || question.userId !== userId) {\n    return new Response(\"You do not have permission to do this\", {\n      status: 403,\n    })\n  }\n\n  return createDataStreamResponse({\n    execute: async dataStream => {\n      const res = generateAiQuestionFeedback({\n        question: question.text,\n        answer,\n      })\n      res.mergeIntoDataStream(dataStream, { sendUsage: false })\n    },\n  })\n}\n\nasync function getQuestion(questionId: string) {\n  const [row] = await db\n    .select({\n      text: QuestionsTable.text,\n      userId: JobInfoTable.userId,\n    })\n    .from(QuestionsTable)\n    .innerJoin(JobInfoTable, eq(QuestionsTable.jobInfoId, JobInfoTable.id))\n    .where(eq(QuestionsTable.id, questionId))\n\n  return row\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AAEA,MAAM,SAAS,yJAAC,CAAC,MAAM,CAAC;IACtB,QAAQ,yJAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,YAAY,yJAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC7B;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,OAAO,SAAS,CAAC;IAEhC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,IAAI,SAAS,kCAAkC;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,EAAE,QAAQ,MAAM,EAAE,UAAU,EAAE,GAAG,OAAO,IAAI;IAClD,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,4JAAc;IAEvC,IAAI,UAAU,MAAM;QAClB,OAAO,IAAI,SAAS,yBAAyB;YAAE,QAAQ;QAAI;IAC7D;IAEA,MAAM,WAAW,MAAM,YAAY;IACnC,IAAI,YAAY,QAAQ,SAAS,MAAM,KAAK,QAAQ;QAClD,OAAO,IAAI,SAAS,yCAAyC;YAC3D,QAAQ;QACV;IACF;IAEA,OAAO,IAAA,kLAAwB,EAAC;QAC9B,SAAS,OAAM;YACb,MAAM,MAAM,IAAA,kKAA0B,EAAC;gBACrC,UAAU,SAAS,IAAI;gBACvB;YACF;YACA,IAAI,mBAAmB,CAAC,YAAY;gBAAE,WAAW;YAAM;QACzD;IACF;AACF;AAEA,eAAe,YAAY,UAAkB;IAC3C,MAAM,CAAC,IAAI,GAAG,MAAM,4HAAE,CACnB,MAAM,CAAC;QACN,MAAM,yJAAc,CAAC,IAAI;QACzB,QAAQ,yJAAY,CAAC,MAAM;IAC7B,GACC,IAAI,CAAC,yJAAc,EACnB,SAAS,CAAC,yJAAY,EAAE,IAAA,0KAAE,EAAC,yJAAc,CAAC,SAAS,EAAE,yJAAY,CAAC,EAAE,GACpE,KAAK,CAAC,IAAA,0KAAE,EAAC,yJAAc,CAAC,EAAE,EAAE;IAE/B,OAAO;AACT","debugId":null}}]
}