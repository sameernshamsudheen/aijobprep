{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/jobinfos/dbCache.ts"],"sourcesContent":["import { getGlobalTag, getIdTag, getUserTag } from \"@/lib/dataCache\"\nimport { revalidateTag } from \"next/cache\"\n\nexport function getJobInfoGlobalTag() {\n  return getGlobalTag(\"jobInfos\")\n}\n\nexport function getJobInfoUserTag(userId: string) {\n  return getUserTag(\"jobInfos\", userId)\n}\n\nexport function getJobInfoIdTag(id: string) {\n  return getIdTag(\"jobInfos\", id)\n}\n\nexport function revalidateJobInfoCache({\n  id,\n  userId,\n}: {\n  id: string\n  userId: string\n}) {\n  revalidateTag(getJobInfoGlobalTag())\n  revalidateTag(getJobInfoUserTag(userId))\n  revalidateTag(getJobInfoIdTag(id))\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS;IACd,OAAO,IAAA,uIAAY,EAAC;AACtB;AAEO,SAAS,kBAAkB,MAAc;IAC9C,OAAO,IAAA,qIAAU,EAAC,YAAY;AAChC;AAEO,SAAS,gBAAgB,EAAU;IACxC,OAAO,IAAA,mIAAQ,EAAC,YAAY;AAC9B;AAEO,SAAS,uBAAuB,EACrC,EAAE,EACF,MAAM,EAIP;IACC,IAAA,8IAAa,EAAC;IACd,IAAA,8IAAa,EAAC,kBAAkB;IAChC,IAAA,8IAAa,EAAC,gBAAgB;AAChC","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/lib/hasPermission.ts"],"sourcesContent":["import { auth } from \"@clerk/nextjs/server\"\n\ntype Permission =\n  | \"unlimited_resume_analysis\"\n  | \"unlimited_interviews\"\n  | \"unlimited_questions\"\n  | \"1_interview\"\n  | \"5_questions\"\n\nexport async function hasPermission(permission: Permission) {\n  const { has } = await auth()\n  return has({ feature: permission })\n}"],"names":[],"mappings":";;;AAAA;;AASO,eAAe,cAAc,UAAsB;IACxD,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAA,2LAAI;IAC1B,OAAO,IAAI;QAAE,SAAS;IAAW;AACnC","debugId":null}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/questions/permission.ts"],"sourcesContent":["import { db } from \"@/drizzle/db\"\nimport { JobInfoTable, QuestionsTable } from \"@/drizzle/schema\"\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { hasPermission } from \"@/services/lib/hasPermission\"\nimport { count, eq } from \"drizzle-orm\"\n\nexport async function canCreateQuestion() {\n  return await Promise.any([\n    hasPermission(\"unlimited_questions\").then(bool => bool || Promise.reject()),\n    Promise.all([hasPermission(\"5_questions\"), getUserQuestionCount()]).then(\n      ([has, c]) => {\n        if (has && c < 5) return true\n        return Promise.reject()\n      }\n    ),\n  ]).catch(() => false)\n}\n\nasync function getUserQuestionCount() {\n  const { userId } = await getCurrentUser()\n  if (userId == null) return 0\n\n  return getQuestionCount(userId)\n}\n\nasync function getQuestionCount(userId: string) {\n  const [{ count: c }] = await db\n    .select({ count: count() })\n    .from(QuestionsTable)\n    .innerJoin(JobInfoTable, eq(QuestionsTable.jobInfoId, JobInfoTable.id))\n    .where(eq(JobInfoTable.userId, userId))\n\n  return c\n}"],"names":[],"mappings":";;;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;;;;;;;;;;;AAEO,eAAe;IACpB,OAAO,MAAM,QAAQ,GAAG,CAAC;QACvB,IAAA,wJAAa,EAAC,uBAAuB,IAAI,CAAC,CAAA,OAAQ,QAAQ,QAAQ,MAAM;QACxE,QAAQ,GAAG,CAAC;YAAC,IAAA,wJAAa,EAAC;YAAgB;SAAuB,EAAE,IAAI,CACtE,CAAC,CAAC,KAAK,EAAE;YACP,IAAI,OAAO,IAAI,GAAG,OAAO;YACzB,OAAO,QAAQ,MAAM;QACvB;KAEH,EAAE,KAAK,CAAC,IAAM;AACjB;AAEA,eAAe;IACb,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,0JAAc;IACvC,IAAI,UAAU,MAAM,OAAO;IAE3B,OAAO,iBAAiB;AAC1B;AAEA,eAAe,iBAAiB,MAAc;IAC5C,MAAM,CAAC,EAAE,OAAO,CAAC,EAAE,CAAC,GAAG,MAAM,0HAAE,CAC5B,MAAM,CAAC;QAAE,OAAO,IAAA,wKAAK;IAAG,GACxB,IAAI,CAAC,uJAAc,EACnB,SAAS,CAAC,uJAAY,EAAE,IAAA,wKAAE,EAAC,uJAAc,CAAC,SAAS,EAAE,uJAAY,CAAC,EAAE,GACpE,KAAK,CAAC,IAAA,wKAAE,EAAC,uJAAY,CAAC,MAAM,EAAE;IAEjC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/questions/_NewQuestionClientPage.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const NewQuestionClientPage = registerClientReference(\n    function() { throw new Error(\"Attempted to call NewQuestionClientPage() from the server but NewQuestionClientPage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/app/job-infos/[jobInfoId]/questions/_NewQuestionClientPage.tsx <module evaluation>\",\n    \"NewQuestionClientPage\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;AACvE;;AACO,MAAM,wBAAwB,IAAA,wQAAuB,EACxD;IAAa,MAAM,IAAI,MAAM;AAA0P,GACvR,wGACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/questions/_NewQuestionClientPage.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const NewQuestionClientPage = registerClientReference(\n    function() { throw new Error(\"Attempted to call NewQuestionClientPage() from the server but NewQuestionClientPage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/app/job-infos/[jobInfoId]/questions/_NewQuestionClientPage.tsx\",\n    \"NewQuestionClientPage\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;AACvE;;AACO,MAAM,wBAAwB,IAAA,wQAAuB,EACxD;IAAa,MAAM,IAAI,MAAM;AAA0P,GACvR,oFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/questions/page.tsx"],"sourcesContent":["import { db } from \"@/drizzle/db\"\nimport { JobInfoTable } from \"@/drizzle/schema\"\nimport { getJobInfoIdTag } from \"@/features/jobinfos/dbCache\"\nimport { canCreateQuestion } from \"@/features/questions/permission\"\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { and, eq } from \"drizzle-orm\"\nimport { Loader2Icon } from \"lucide-react\"\nimport { cacheTag } from \"next/dist/server/use-cache/cache-tag\"\nimport { notFound, redirect } from \"next/navigation\"\nimport { Suspense } from \"react\"\nimport { NewQuestionClientPage } from \"./_NewQuestionClientPage\"\n\nexport default async function QuestionsPage({\n  params,\n}: {\n  params: Promise<{ jobInfoId: string }>\n}) {\n  const { jobInfoId } = await params\n\n  return (\n    <Suspense\n      fallback={\n        <div className=\"h-screen-header flex items-center justify-center\">\n          <Loader2Icon className=\"animate-spin size-24\" />\n        </div>\n      }\n    >\n      <SuspendedComponent jobInfoId={jobInfoId} />\n    </Suspense>\n  )\n}\n\nasync function SuspendedComponent({ jobInfoId }: { jobInfoId: string }) {\n  const { userId, redirectToSignIn } = await getCurrentUser()\n  if (userId == null) return redirectToSignIn()\n\n  if (!(await canCreateQuestion())) return redirect(\"/app/upgrade\")\n\n  const jobInfo = await getJobInfo(jobInfoId, userId)\n  if (jobInfo == null) return notFound()\n\n  return <NewQuestionClientPage jobInfo={jobInfo} />\n}\n\nasync function getJobInfo(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getJobInfoIdTag(id))\n\n  return db.query.JobInfoTable.findFirst({\n    where: and(eq(JobInfoTable.id, id), eq(JobInfoTable.userId, userId)),\n  })\n}"],"names":[],"mappings":";;;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AAEe,eAAe,cAAc,EAC1C,MAAM,EAGP;IACC,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAE5B,qBACE,8OAAC,iNAAQ;QACP,wBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC,oOAAW;gBAAC,WAAU;;;;;;;;;;;kBAI3B,cAAA,8OAAC;YAAmB,WAAW;;;;;;;;;;;AAGrC;AAEA,eAAe,mBAAmB,EAAE,SAAS,EAAyB;IACpE,MAAM,EAAE,MAAM,EAAE,gBAAgB,EAAE,GAAG,MAAM,IAAA,0JAAc;IACzD,IAAI,UAAU,MAAM,OAAO;IAE3B,IAAI,CAAE,MAAM,IAAA,+JAAiB,KAAK,OAAO,IAAA,iMAAQ,EAAC;IAElD,MAAM,UAAU,MAAM,WAAW,WAAW;IAC5C,IAAI,WAAW,MAAM,OAAO,IAAA,iMAAQ;IAEpC,qBAAO,8OAAC,mNAAqB;QAAC,SAAS;;;;;;AACzC;IAEA,6SAAA,eAAe,WAAW,EAAU,EAAE,MAAc;IAElD,IAAA,kLAAQ,EAAC,IAAA,yJAAe,EAAC;IAEzB,OAAO,0HAAE,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC;QACrC,OAAO,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,uJAAY,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,uJAAY,CAAC,MAAM,EAAE;IAC9D;AACF;;;;;;IAPe","debugId":null}}]
}