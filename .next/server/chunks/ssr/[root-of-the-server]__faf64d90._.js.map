{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/data/env/client.ts"],"sourcesContent":["import { createEnv } from \"@t3-oss/env-nextjs\";\nimport { z } from \"zod\";\n\nexport const clientEnv = createEnv({\n  client: {\n    NEXT_PUBLIC_CLERK_SIGN_IN_URL: z.string().min(1),\n    NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL: z.string().min(1),\n    NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL: z.string().min(1),\n    NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: z.string().min(1),\n    NEXT_PUBLIC_HUME_CONFIG_ID: z.string().min(1),\n  },\n  experimental__runtimeEnv: {\n    NEXT_PUBLIC_CLERK_SIGN_IN_URL: process.env.NEXT_PUBLIC_CLERK_SIGN_IN_URL,\n    NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL:\n      process.env.NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL,\n    NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL:\n      process.env.NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL,\n    NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY:\n      process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY,\n    NEXT_PUBLIC_HUME_CONFIG_ID: process.env.NEXT_PUBLIC_HUME_CONFIG_ID,\n  },\n  emptyStringAsUndefined: true,\n});\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,MAAM,YAAY,IAAA,0KAAS,EAAC;IACjC,QAAQ;QACN,+BAA+B,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC9C,iDAAiD,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAChE,iDAAiD,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAChE,mCAAmC,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAClD,4BAA4B,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC7C;IACA,0BAA0B;QACxB,6BAA6B;QAC7B,+CAA+C;QAE/C,+CAA+C;QAE/C,iCAAiC;QAEjC,0BAA0B;IAC5B;IACA,wBAAwB;AAC1B","debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/interviews/action.ts"],"sourcesContent":["\"use server\"\n\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { cacheTag } from \"next/dist/server/use-cache/cache-tag\"\nimport { getJobInfoIdTag } from \"../jobinfos/dbCache\"\nimport { db } from \"@/drizzle/db\"\nimport { and, eq } from \"drizzle-orm\"\nimport { InterviewsTable, JobInfoTable } from \"@/drizzle/schema\"\nimport { insertInterview, updateInterview as updateInterviewDb } from \"./db\"\nimport { getInterviewIdTag } from \"./dbCache\"\nimport { canCreateInterview } from \"./permission\"\nimport { PLAN_LIMIT_MESSAGE, RATE_LIMIT_MESSAGE } from \"@/lib/errorMessages\"\nimport { serverEnv } from \"@/data/env/server\"\nimport arcjet, { tokenBucket, request } from \"@arcjet/next\"\nimport { generateAiInterviewFeedback } from \"@/services/ai/interviews\"\n\nconst aj = arcjet({\n  characteristics: [\"userId\"],\n  key: serverEnv.ARCJET_KEY,\n  rules: [\n    tokenBucket({\n      capacity: 20,\n      refillRate: 4,\n      interval: \"1d\",\n      mode: \"LIVE\",\n    }),\n  ],\n})\n\nexport async function createInterview({\n  jobInfoId,\n}: {\n  jobInfoId: string\n}): Promise<{ error: true; message: string } | { error: false; id: string }> {\n  const { userId } = await getCurrentUser()\n  if (userId == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  if (!(await canCreateInterview())) {\n    return {\n      error: true,\n      message: PLAN_LIMIT_MESSAGE,\n    }\n  }\n\n  const decision = await aj.protect(await request(), {\n    userId,\n    requested: 1,\n  })\n\n  if (decision.isDenied()) {\n    return {\n      error: true,\n      message: RATE_LIMIT_MESSAGE,\n    }\n  }\n\n  const jobInfo = await getJobInfo(jobInfoId, userId)\n  if (jobInfo == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await insertInterview({\n      jobInfoId, duration: \"00:00:00\",\n      humeChatId: \"\"\n  })\n\n  return { error: false, id: interview.id }\n}\n\nexport async function updateInterview(\n  id: string,\n  data: {\n    humeChatId?: string\n    duration?: string\n  }\n) {\n  const { userId } = await getCurrentUser()\n  if (userId == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await getInterview(id, userId)\n  if (interview == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  await updateInterviewDb(id, data)\n\n  return { error: false }\n}\n\nexport async function generateInterviewFeedback(interviewId: string) {\n  const { userId, user } = await getCurrentUser({ allData: true })\n  if (userId == null || user == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await getInterview(interviewId, userId)\n  if (interview == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  if (interview.humeChatId == null) {\n    return {\n      error: true,\n      message: \"Interview has not been completed yet\",\n    }\n  }\n\n  // const feedback = await generateAiInterviewFeedback({\n  // })\n\n  // if (feedback == null) {\n  //   return {\n  //     error: true,\n  //     message: \"Failed to generate feedback\",\n  //   }\n  // }\n\n  // await updateInterviewDb(interviewId, { feedback })\n\n  return { error: false }\n}\n\nasync function getJobInfo(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getJobInfoIdTag(id))\n\n  return db.query.JobInfoTable.findFirst({\n    where: and(eq(JobInfoTable.id, id), eq(JobInfoTable.userId, userId)),\n  })\n}\n\nasync function getInterview(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getInterviewIdTag(id))\n\n  const interview = await db.query.InterviewsTable.findFirst({\n    where: eq(InterviewsTable.id, id),\n    with: {\n      jobInfo: {\n        columns: {\n          id: true,\n          userId: true,\n          description: true,\n          title: true,\n          experienceLevel: true,\n        },\n      },\n    },\n  })\n\n  if (interview == null) return null\n\n  cacheTag(getJobInfoIdTag(interview.jobInfo.id))\n  if (interview.jobInfo.userId !== userId) return null\n\n  return interview\n}\n"],"names":[],"mappings":";;;;;;IA6BsB,kBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/interviews/action.ts"],"sourcesContent":["\"use server\"\n\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { cacheTag } from \"next/dist/server/use-cache/cache-tag\"\nimport { getJobInfoIdTag } from \"../jobinfos/dbCache\"\nimport { db } from \"@/drizzle/db\"\nimport { and, eq } from \"drizzle-orm\"\nimport { InterviewsTable, JobInfoTable } from \"@/drizzle/schema\"\nimport { insertInterview, updateInterview as updateInterviewDb } from \"./db\"\nimport { getInterviewIdTag } from \"./dbCache\"\nimport { canCreateInterview } from \"./permission\"\nimport { PLAN_LIMIT_MESSAGE, RATE_LIMIT_MESSAGE } from \"@/lib/errorMessages\"\nimport { serverEnv } from \"@/data/env/server\"\nimport arcjet, { tokenBucket, request } from \"@arcjet/next\"\nimport { generateAiInterviewFeedback } from \"@/services/ai/interviews\"\n\nconst aj = arcjet({\n  characteristics: [\"userId\"],\n  key: serverEnv.ARCJET_KEY,\n  rules: [\n    tokenBucket({\n      capacity: 20,\n      refillRate: 4,\n      interval: \"1d\",\n      mode: \"LIVE\",\n    }),\n  ],\n})\n\nexport async function createInterview({\n  jobInfoId,\n}: {\n  jobInfoId: string\n}): Promise<{ error: true; message: string } | { error: false; id: string }> {\n  const { userId } = await getCurrentUser()\n  if (userId == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  if (!(await canCreateInterview())) {\n    return {\n      error: true,\n      message: PLAN_LIMIT_MESSAGE,\n    }\n  }\n\n  const decision = await aj.protect(await request(), {\n    userId,\n    requested: 1,\n  })\n\n  if (decision.isDenied()) {\n    return {\n      error: true,\n      message: RATE_LIMIT_MESSAGE,\n    }\n  }\n\n  const jobInfo = await getJobInfo(jobInfoId, userId)\n  if (jobInfo == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await insertInterview({\n      jobInfoId, duration: \"00:00:00\",\n      humeChatId: \"\"\n  })\n\n  return { error: false, id: interview.id }\n}\n\nexport async function updateInterview(\n  id: string,\n  data: {\n    humeChatId?: string\n    duration?: string\n  }\n) {\n  const { userId } = await getCurrentUser()\n  if (userId == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await getInterview(id, userId)\n  if (interview == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  await updateInterviewDb(id, data)\n\n  return { error: false }\n}\n\nexport async function generateInterviewFeedback(interviewId: string) {\n  const { userId, user } = await getCurrentUser({ allData: true })\n  if (userId == null || user == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  const interview = await getInterview(interviewId, userId)\n  if (interview == null) {\n    return {\n      error: true,\n      message: \"You don't have permission to do this\",\n    }\n  }\n\n  if (interview.humeChatId == null) {\n    return {\n      error: true,\n      message: \"Interview has not been completed yet\",\n    }\n  }\n\n  // const feedback = await generateAiInterviewFeedback({\n  // })\n\n  // if (feedback == null) {\n  //   return {\n  //     error: true,\n  //     message: \"Failed to generate feedback\",\n  //   }\n  // }\n\n  // await updateInterviewDb(interviewId, { feedback })\n\n  return { error: false }\n}\n\nasync function getJobInfo(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getJobInfoIdTag(id))\n\n  return db.query.JobInfoTable.findFirst({\n    where: and(eq(JobInfoTable.id, id), eq(JobInfoTable.userId, userId)),\n  })\n}\n\nasync function getInterview(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getInterviewIdTag(id))\n\n  const interview = await db.query.InterviewsTable.findFirst({\n    where: eq(InterviewsTable.id, id),\n    with: {\n      jobInfo: {\n        columns: {\n          id: true,\n          userId: true,\n          description: true,\n          title: true,\n          experienceLevel: true,\n        },\n      },\n    },\n  })\n\n  if (interview == null) return null\n\n  cacheTag(getJobInfoIdTag(interview.jobInfo.id))\n  if (interview.jobInfo.userId !== userId) return null\n\n  return interview\n}\n"],"names":[],"mappings":";;;;;;IA6EsB,kBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/lib/errorMessages.ts"],"sourcesContent":["export const PLAN_LIMIT_MESSAGE = \"PLAN_LIMIT\"\nexport const RATE_LIMIT_MESSAGE = \"RATE_LIMIT\"\n"],"names":[],"mappings":";;;;AAAO,MAAM,qBAAqB;AAC3B,MAAM,qBAAqB","debugId":null}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/lib/errorToast.tsx"],"sourcesContent":["\"use client\"\n\nimport { Button } from \"@/components/ui/button\"\nimport Link from \"next/link\"\nimport { toast } from \"sonner\"\nimport { PLAN_LIMIT_MESSAGE, RATE_LIMIT_MESSAGE } from \"@/lib/errorMessages\"\n\nexport function errorToast(message: string) {\n  if (message === PLAN_LIMIT_MESSAGE) {\n    const toastId = toast.error(\"You have reached your plan limit.\", {\n      action: (\n        <Button\n          size=\"sm\"\n          asChild\n          onClick={() => {\n            toast.dismiss(toastId)\n          }}\n        >\n          <Link href=\"/app/upgrade\">Upgrade</Link>\n        </Button>\n      ),\n    })\n    return\n  }\n\n  if (message === RATE_LIMIT_MESSAGE) {\n    toast.error(\"Woah! Slow down.\", {\n      description: \"You are making too many requests. Please try again later.\",\n    })\n    return\n  }\n\n  toast.error(message)\n}\n\nexport { PLAN_LIMIT_MESSAGE }\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOO,SAAS,WAAW,OAAe;IACxC,IAAI,YAAY,iJAAkB,EAAE;QAClC,MAAM,UAAU,iJAAK,CAAC,KAAK,CAAC,qCAAqC;YAC/D,sBACE,8OAAC,4IAAM;gBACL,MAAK;gBACL,OAAO;gBACP,SAAS;oBACP,iJAAK,CAAC,OAAO,CAAC;gBAChB;0BAEA,cAAA,8OAAC,uKAAI;oBAAC,MAAK;8BAAe;;;;;;;;;;;QAGhC;QACA;IACF;IAEA,IAAI,YAAY,iJAAkB,EAAE;QAClC,iJAAK,CAAC,KAAK,CAAC,oBAAoB;YAC9B,aAAa;QACf;QACA;IACF;IAEA,iJAAK,CAAC,KAAK,CAAC;AACd","debugId":null}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/hume/components/CondensedMessages.tsx"],"sourcesContent":["import { UserAvatar } from \"@/features/users/components/UserAvatar\"\nimport { cn } from \"@/lib/utils\"\nimport { BrainCircuitIcon } from \"lucide-react\"\n\nexport function CondensedMessages({\n  messages,\n  user,\n  className,\n  maxFft = 0,\n}: {\n  messages: { isUser: boolean; content: string[] }[]\n  user: { name: string; imageUrl: string }\n  className?: string\n  maxFft?: number\n}) {\n  return (\n    <div className={cn(\"flex flex-col gap-4 w-full\", className)}>\n      {messages.map((message, index) => {\n        const shouldAnimate = index === messages.length - 1 && maxFft > 0\n\n        return (\n          <div\n            key={index}\n            className={cn(\n              \"flex items-center gap-5 border pl-4 pr-6 py-4 rounded max-w-3/4\",\n              message.isUser ? \"self-end\" : \"self-start\"\n            )}\n          >\n            {message.isUser ? (\n              <UserAvatar user={user} className=\"size-6 flex-shrink-0\" />\n            ) : (\n              <div className=\"relative\">\n                <div\n                  className={cn(\n                    \"absolute inset-0 border-muted border-4 rounded-full\",\n                    shouldAnimate ? \"animate-ping\" : \"hidden\"\n                  )}\n                />\n                <BrainCircuitIcon\n                  className=\"size-6 flex-shrink-0 relative\"\n                  style={shouldAnimate ? { scale: maxFft / 8 + 1 } : undefined}\n                />\n              </div>\n            )}\n            <div className=\"flex flex-col gap-1\">\n              {message.content.map((text, i) => (\n                <span key={i}>{text}</span>\n              ))}\n            </div>\n          </div>\n        )\n      })}\n    </div>\n  )\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAEO,SAAS,kBAAkB,EAChC,QAAQ,EACR,IAAI,EACJ,SAAS,EACT,SAAS,CAAC,EAMX;IACC,qBACE,8OAAC;QAAI,WAAW,IAAA,yHAAE,EAAC,8BAA8B;kBAC9C,SAAS,GAAG,CAAC,CAAC,SAAS;YACtB,MAAM,gBAAgB,UAAU,SAAS,MAAM,GAAG,KAAK,SAAS;YAEhE,qBACE,8OAAC;gBAEC,WAAW,IAAA,yHAAE,EACX,mEACA,QAAQ,MAAM,GAAG,aAAa;;oBAG/B,QAAQ,MAAM,iBACb,8OAAC,mKAAU;wBAAC,MAAM;wBAAM,WAAU;;;;;6CAElC,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,WAAW,IAAA,yHAAE,EACX,uDACA,gBAAgB,iBAAiB;;;;;;0CAGrC,8OAAC,8OAAgB;gCACf,WAAU;gCACV,OAAO,gBAAgB;oCAAE,OAAO,SAAS,IAAI;gCAAE,IAAI;;;;;;;;;;;;kCAIzD,8OAAC;wBAAI,WAAU;kCACZ,QAAQ,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,kBAC1B,8OAAC;0CAAc;+BAAJ;;;;;;;;;;;eAxBV;;;;;QA6BX;;;;;;AAGN","debugId":null}},
    {"offset": {"line": 299, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/services/hume/lib/condensedChat.tsx"],"sourcesContent":["import { ConnectionMessage } from \"@humeai/voice-react\"\nimport { JsonMessage, ReturnChatEvent } from \"hume/api/resources/empathicVoice\"\n\ntype Message = JsonMessage | ConnectionMessage | ReturnChatEvent\n\nexport function condenseChatMessages(messages: Message[]) {\n  return messages.reduce((acc, message) => {\n    const data = getChatEventData(message) ?? getJsonMessageData(message)\n    if (data == null || data.content == null) {\n      return acc\n    }\n\n    const lastMessage = acc.at(-1)\n    if (lastMessage == null) {\n      acc.push({ isUser: data.isUser, content: [data.content] })\n      return acc\n    }\n\n    if (lastMessage.isUser === data.isUser) {\n      lastMessage.content.push(data.content)\n    } else {\n      acc.push({ isUser: data.isUser, content: [data.content] })\n    }\n\n    return acc\n  }, [] as { isUser: boolean; content: string[] }[])\n}\n\nfunction getJsonMessageData(message: Message) {\n  if (message.type !== \"user_message\" && message.type !== \"assistant_message\") {\n    return null\n  }\n\n  return {\n    isUser: message.type === \"user_message\",\n    content: message.message.content,\n  }\n}\n\nfunction getChatEventData(message: Message) {\n  if (message.type !== \"USER_MESSAGE\" && message.type !== \"AGENT_MESSAGE\") {\n    return null\n  }\n\n  return {\n    isUser: message.type === \"USER_MESSAGE\",\n    content: message.messageText,\n  }\n}"],"names":[],"mappings":";;;AAKO,SAAS,qBAAqB,QAAmB;IACtD,OAAO,SAAS,MAAM,CAAC,CAAC,KAAK;QAC3B,MAAM,OAAO,iBAAiB,YAAY,mBAAmB;QAC7D,IAAI,QAAQ,QAAQ,KAAK,OAAO,IAAI,MAAM;YACxC,OAAO;QACT;QAEA,MAAM,cAAc,IAAI,EAAE,CAAC,CAAC;QAC5B,IAAI,eAAe,MAAM;YACvB,IAAI,IAAI,CAAC;gBAAE,QAAQ,KAAK,MAAM;gBAAE,SAAS;oBAAC,KAAK,OAAO;iBAAC;YAAC;YACxD,OAAO;QACT;QAEA,IAAI,YAAY,MAAM,KAAK,KAAK,MAAM,EAAE;YACtC,YAAY,OAAO,CAAC,IAAI,CAAC,KAAK,OAAO;QACvC,OAAO;YACL,IAAI,IAAI,CAAC;gBAAE,QAAQ,KAAK,MAAM;gBAAE,SAAS;oBAAC,KAAK,OAAO;iBAAC;YAAC;QAC1D;QAEA,OAAO;IACT,GAAG,EAAE;AACP;AAEA,SAAS,mBAAmB,OAAgB;IAC1C,IAAI,QAAQ,IAAI,KAAK,kBAAkB,QAAQ,IAAI,KAAK,qBAAqB;QAC3E,OAAO;IACT;IAEA,OAAO;QACL,QAAQ,QAAQ,IAAI,KAAK;QACzB,SAAS,QAAQ,OAAO,CAAC,OAAO;IAClC;AACF;AAEA,SAAS,iBAAiB,OAAgB;IACxC,IAAI,QAAQ,IAAI,KAAK,kBAAkB,QAAQ,IAAI,KAAK,iBAAiB;QACvE,OAAO;IACT;IAEA,OAAO;QACL,QAAQ,QAAQ,IAAI,KAAK;QACzB,SAAS,QAAQ,WAAW;IAC9B;AACF","debugId":null}},
    {"offset": {"line": 353, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/interviews/new/_StartCall.tsx"],"sourcesContent":["\"use client\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { clientEnv } from \"@/data/env/client\"\nimport { JobInfoTable } from \"@/drizzle/schema\"\nimport { createInterview, updateInterview } from \"@/features/interviews/action\"\nimport { errorToast } from \"@/lib/errorToast\"\nimport { CondensedMessages } from \"@/services/hume/components/CondensedMessages\"\nimport { condenseChatMessages } from \"@/services/hume/lib/condensedChat\"\nimport { useVoice, VoiceReadyState } from \"@humeai/voice-react\"\nimport { Loader2Icon, MicIcon, MicOffIcon, PhoneOffIcon } from \"lucide-react\"\nimport { useRouter } from \"next/navigation\"\nimport { useEffect, useMemo, useRef, useState } from \"react\"\n\nexport function StartCall({\n  jobInfo,\n  user,\n  accessToken,\n}: {\n  accessToken: string\n  jobInfo: Pick<\n    typeof JobInfoTable.$inferSelect,\n    \"id\" | \"title\" | \"description\" | \"experienceLevel\"\n  >\n  user: {\n    name: string\n    imageUrl: string\n  }\n}) {\n  const {\n    connect,\n    readyState,\n    chatMetadata,\n    callDurationTimestamp,\n    error,\n    status,\n    isError,\n    isMicrophoneError,\n    isSocketError,\n  } = useVoice()\n  const [interviewId, setInterviewId] = useState<string | null>(null)\n  const durationRef = useRef(callDurationTimestamp)\n  const router = useRouter()\n  durationRef.current = callDurationTimestamp\n\n  useEffect(() => {\n    console.log(\"StartCall: readyState\", readyState)\n  }, [readyState])\n\n  useEffect(() => {\n    if (chatMetadata == null) return\n    console.log(\"StartCall: chatMetadata update\", chatMetadata)\n  }, [chatMetadata])\n\n  useEffect(() => {\n    if (error == null && status == null) return\n    console.log(\"StartCall: status\", status)\n    console.log(\"StartCall: voice error\", error)\n    if (!isError) return\n    if (error?.type === \"mic_error\") {\n      errorToast(error.message)\n    } else if (error?.type === \"socket_error\") {\n      errorToast(error.message)\n    }\n  }, [error, isError, status])\n\n  // Sync chat ID\n  useEffect(() => {\n    if (chatMetadata?.chatId == null || interviewId == null) {\n      return\n    }\n    console.log(\"StartCall: chatMetadata received\", chatMetadata)\n    console.log(\"StartCall: syncing chatId\", {\n      interviewId,\n      chatId: chatMetadata.chatId,\n    })\n    updateInterview(interviewId, { humeChatId: chatMetadata.chatId })\n  }, [chatMetadata?.chatId, interviewId])\n\n  // Sync duration\n  useEffect(() => {\n    if (interviewId == null) return\n    const intervalId = setInterval(() => {\n      if (durationRef.current == null) return\n\n      updateInterview(interviewId, { duration: durationRef.current })\n    }, 10000)\n\n    return () => clearInterval(intervalId)\n  }, [interviewId])\n\n  // Handle disconnect\n  useEffect(() => {\n    if (readyState !== VoiceReadyState.CLOSED) return\n    if (interviewId == null) {\n      return router.push(`/app/job-infos/${jobInfo.id}/interviews`)\n    }\n\n    if (durationRef.current != null) {\n      updateInterview(interviewId, { duration: durationRef.current })\n    }\n    router.push(`/app/job-infos/${jobInfo.id}/interviews/${interviewId}`)\n  }, [interviewId, readyState, router, jobInfo.id])\n\n  if (readyState === VoiceReadyState.IDLE) {\n    return (\n      <div className=\"flex justify-center items-center h-screen-header\">\n        <Button\n          size=\"lg\"\n          onClick={async () => {\n            console.log(\"StartCall: start clicked\")\n            try {\n              const res = await createInterview({ jobInfoId: jobInfo.id })\n              if (res.error) {\n                return errorToast(res.message)\n              }\n\n              setInterviewId(res.id)\n\n              console.log(\"StartCall: created interview\", res.id)\n              console.log(\"StartCall: connect config\", {\n                configId: clientEnv.NEXT_PUBLIC_HUME_CONFIG_ID,\n                accessTokenLength: accessToken?.length ?? 0,\n              })\n              await connect({\n                auth: { type: \"accessToken\", value: accessToken },\n                configId: clientEnv.NEXT_PUBLIC_HUME_CONFIG_ID,\n                sessionSettings: {\n                  type: \"session_settings\",\n                  variables: {\n                    userName: user.name,\n                    title: jobInfo.title || \"Not Specified\",\n                    description: jobInfo.description,\n                    experienceLevel: jobInfo.experienceLevel,\n                  },\n                },\n              })\n              console.log(\"StartCall: connect resolved\")\n            } catch (err) {\n              const message =\n                err instanceof Error ? err.message : \"Failed to start interview\"\n              errorToast(message)\n            }\n          }}\n        >\n          Start Interview\n        </Button>\n      </div>\n    )\n  }\n\n  if (\n    readyState === VoiceReadyState.CONNECTING ||\n    readyState === VoiceReadyState.CLOSED\n  ) {\n    return (\n      <div className=\"h-screen-header flex items-center justify-center\">\n        <Loader2Icon className=\"animate-spin size-24\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"overflow-y-auto h-screen-header flex flex-col-reverse\">\n      <div className=\"container py-6 flex flex-col items-center justify-end gap-4\">\n        <Messages user={user} />\n        <Controls />\n      </div>\n    </div>\n  )\n}\n\nfunction Messages({ user }: { user: { name: string; imageUrl: string } }) {\n  const { messages, fft } = useVoice()\n\n  const condensedMessages = useMemo(() => {\n    return condenseChatMessages(messages as any)\n  }, [messages])\n\n  return (\n    <CondensedMessages\n      messages={condensedMessages}\n      user={user}\n      maxFft={Math.max(...fft)}\n      className=\"max-w-5xl\"\n    />\n  )\n}\n\nfunction Controls() {\n  const { disconnect, isMuted, mute, unmute, micFft, callDurationTimestamp } =\n    useVoice()\n\n  return (\n    <div className=\"flex gap-5 rounded border px-5 py-2 w-fit sticky bottom-6 bg-background items-center\">\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className=\"-mx-3\"\n        onClick={() => (isMuted ? unmute() : mute())}\n      >\n        {isMuted ? <MicOffIcon className=\"text-destructive\" /> : <MicIcon />}\n        <span className=\"sr-only\">{isMuted ? \"Unmute\" : \"Mute\"}</span>\n      </Button>\n      <div className=\"self-stretch\">\n        <FftVisualizer fft={micFft} />\n      </div>\n      <div className=\"text-sm text-muted-foreground tabular-nums\">\n        {callDurationTimestamp}\n      </div>\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className=\"-mx-3\"\n        onClick={disconnect}\n      >\n        <PhoneOffIcon className=\"text-destructive\" />\n        <span className=\"sr-only\">End Call</span>\n      </Button>\n    </div>\n  )\n}\n\nfunction FftVisualizer({ fft }: { fft: number[] }) {\n  return (\n    <div className=\"flex gap-1 items-center h-full\">\n      {fft.map((value, index) => {\n        const percent = (value / 4) * 100\n        return (\n          <div\n            key={index}\n            className=\"min-h-0.5 bg-primary/75 w-0.5 rounded\"\n            style={{ height: `${percent < 10 ? 0 : percent}%` }}\n          />\n        )\n      })}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}