{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/features/jobinfos/dbCache.ts"],"sourcesContent":["import { getGlobalTag, getIdTag, getUserTag } from \"@/lib/dataCache\"\nimport { revalidateTag } from \"next/cache\"\n\nexport function getJobInfoGlobalTag() {\n  return getGlobalTag(\"jobInfos\")\n}\n\nexport function getJobInfoUserTag(userId: string) {\n  return getUserTag(\"jobInfos\", userId)\n}\n\nexport function getJobInfoIdTag(id: string) {\n  return getIdTag(\"jobInfos\", id)\n}\n\nexport function revalidateJobInfoCache({\n  id,\n  userId,\n}: {\n  id: string\n  userId: string\n}) {\n  revalidateTag(getJobInfoGlobalTag())\n  revalidateTag(getJobInfoUserTag(userId))\n  revalidateTag(getJobInfoIdTag(id))\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS;IACd,OAAO,IAAA,uIAAY,EAAC;AACtB;AAEO,SAAS,kBAAkB,MAAc;IAC9C,OAAO,IAAA,qIAAU,EAAC,YAAY;AAChC;AAEO,SAAS,gBAAgB,EAAU;IACxC,OAAO,IAAA,mIAAQ,EAAC,YAAY;AAC9B;AAEO,SAAS,uBAAuB,EACrC,EAAE,EACF,MAAM,EAIP;IACC,IAAA,8IAAa,EAAC;IACd,IAAA,8IAAa,EAAC,kBAAkB;IAChC,IAAA,8IAAa,EAAC,gBAAgB;AAChC","debugId":null}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/interviews/new/_StartCall.tsx"],"sourcesContent":["// \"use client\"\n\n// import { Button } from \"@/components/ui/button\"\n// import { clientEnv } from \"@/data/env/client\"\n// import { JobInfoTable } from \"@/drizzle/schema\"\n// import { createInterview, updateInterview } from \"@/features/interviews/actions\"\n// import { errorToast } from \"@/lib/errorToast\"\n// import { CondensedMessages } from \"@/services/hume/components/CondensedMessages\"\n// import { condenseChatMessages } from \"@/services/hume/lib/condenseChatMessages\"\n// import { useVoice, VoiceReadyState } from \"@humeai/voice-react\"\n// import { Loader2Icon, MicIcon, MicOffIcon, PhoneOffIcon } from \"lucide-react\"\n// import { useRouter } from \"next/navigation\"\n// import { useEffect, useMemo, useRef, useState } from \"react\"\n\n// export function StartCall({\n//   jobInfo,\n//   user,\n//   accessToken,\n// }: {\n//   accessToken: string\n//   jobInfo: Pick<\n//     typeof JobInfoTable.$inferSelect,\n//     \"id\" | \"title\" | \"description\" | \"experienceLevel\"\n//   >\n//   user: {\n//     name: string\n//     imageUrl: string\n//   }\n// }) {\n//   const { connect, readyState, chatMetadata, callDurationTimestamp } =\n//     useVoice()\n//   const [interviewId, setInterviewId] = useState<string | null>(null)\n//   const durationRef = useRef(callDurationTimestamp)\n//   const router = useRouter()\n//   durationRef.current = callDurationTimestamp\n\n//   // Sync chat ID\n//   useEffect(() => {\n//     if (chatMetadata?.chatId == null || interviewId == null) {\n//       return\n//     }\n//     updateInterview(interviewId, { humeChatId: chatMetadata.chatId })\n//   }, [chatMetadata?.chatId, interviewId])\n\n//   // Sync duration\n//   useEffect(() => {\n//     if (interviewId == null) return\n//     const intervalId = setInterval(() => {\n//       if (durationRef.current == null) return\n\n//       updateInterview(interviewId, { duration: durationRef.current })\n//     }, 10000)\n\n//     return () => clearInterval(intervalId)\n//   }, [interviewId])\n\n//   // Handle disconnect\n//   useEffect(() => {\n//     if (readyState !== VoiceReadyState.CLOSED) return\n//     if (interviewId == null) {\n//       return router.push(`/app/job-infos/${jobInfo.id}/interviews`)\n//     }\n\n//     if (durationRef.current != null) {\n//       updateInterview(interviewId, { duration: durationRef.current })\n//     }\n//     router.push(`/app/job-infos/${jobInfo.id}/interviews/${interviewId}`)\n//   }, [interviewId, readyState, router, jobInfo.id])\n\n//   if (readyState === VoiceReadyState.IDLE) {\n//     return (\n//       <div className=\"flex justify-center items-center h-screen-header\">\n//         <Button\n//           size=\"lg\"\n//           onClick={async () => {\n//             const res = await createInterview({ jobInfoId: jobInfo.id })\n//             if (res.error) {\n//               return errorToast(res.message)\n//             }\n//             setInterviewId(res.id)\n\n//             connect({\n//               auth: { type: \"accessToken\", value: accessToken },\n//               configId: clientEnv.NEXT_PUBLIC_HUME_CONFIG_ID,\n//               sessionSettings: {\n//                 type: \"session_settings\",\n//                 variables: {\n//                   userName: user.name,\n//                   title: jobInfo.title || \"Not Specified\",\n//                   description: jobInfo.description,\n//                   experienceLevel: jobInfo.experienceLevel,\n//                 },\n//               },\n//             })\n//           }}\n//         >\n//           Start Interview\n//         </Button>\n//       </div>\n//     )\n//   }\n\n//   if (\n//     readyState === VoiceReadyState.CONNECTING ||\n//     readyState === VoiceReadyState.CLOSED\n//   ) {\n//     return (\n//       <div className=\"h-screen-header flex items-center justify-center\">\n//         <Loader2Icon className=\"animate-spin size-24\" />\n//       </div>\n//     )\n//   }\n\n//   return (\n//     <div className=\"overflow-y-auto h-screen-header flex flex-col-reverse\">\n//       <div className=\"container py-6 flex flex-col items-center justify-end gap-4\">\n//         <Messages user={user} />\n//         <Controls />\n//       </div>\n//     </div>\n//   )\n// }\n\n// function Messages({ user }: { user: { name: string; imageUrl: string } }) {\n//   const { messages, fft } = useVoice()\n\n//   const condensedMessages = useMemo(() => {\n//     return condenseChatMessages(messages)\n//   }, [messages])\n\n//   return (\n//     <CondensedMessages\n//       messages={condensedMessages}\n//       user={user}\n//       maxFft={Math.max(...fft)}\n//       className=\"max-w-5xl\"\n//     />\n//   )\n// }\n\n// function Controls() {\n//   const { disconnect, isMuted, mute, unmute, micFft, callDurationTimestamp } =\n//     useVoice()\n\n//   return (\n//     <div className=\"flex gap-5 rounded border px-5 py-2 w-fit sticky bottom-6 bg-background items-center\">\n//       <Button\n//         variant=\"ghost\"\n//         size=\"icon\"\n//         className=\"-mx-3\"\n//         onClick={() => (isMuted ? unmute() : mute())}\n//       >\n//         {isMuted ? <MicOffIcon className=\"text-destructive\" /> : <MicIcon />}\n//         <span className=\"sr-only\">{isMuted ? \"Unmute\" : \"Mute\"}</span>\n//       </Button>\n//       <div className=\"self-stretch\">\n//         <FftVisualizer fft={micFft} />\n//       </div>\n//       <div className=\"text-sm text-muted-foreground tabular-nums\">\n//         {callDurationTimestamp}\n//       </div>\n//       <Button\n//         variant=\"ghost\"\n//         size=\"icon\"\n//         className=\"-mx-3\"\n//         onClick={disconnect}\n//       >\n//         <PhoneOffIcon className=\"text-destructive\" />\n//         <span className=\"sr-only\">End Call</span>\n//       </Button>\n//     </div>\n//   )\n// }\n\n// function FftVisualizer({ fft }: { fft: number[] }) {\n//   return (\n//     <div className=\"flex gap-1 items-center h-full\">\n//       {fft.map((value, index) => {\n//         const percent = (value / 4) * 100\n//         return (\n//           <div\n//             key={index}\n//             className=\"min-h-0.5 bg-primary/75 w-0.5 rounded\"\n//             style={{ height: `${percent < 10 ? 0 : percent}%` }}\n//           />\n//         )\n//       })}\n//     </div>\n//   )\n// }"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 308, "column": 0}, "map": {"version":3,"sources":["file:///Users/sameershamsudheen/aijobprep/src/app/app/job-infos/%5BjobInfoId%5D/interviews/new/page.tsx"],"sourcesContent":["import { db } from \"@/drizzle/db\"\nimport { JobInfoTable } from \"@/drizzle/schema\"\nimport { getJobInfoIdTag } from \"@/features/jobinfos/dbCache\"\nimport { getCurrentUser } from \"@/services/lib/getcurrentUser\"\nimport { and, eq } from \"drizzle-orm\"\nimport { Loader2Icon } from \"lucide-react\"\nimport { cacheTag } from \"next/dist/server/use-cache/cache-tag\"\nimport { notFound, redirect } from \"next/navigation\"\nimport { Suspense } from \"react\"\nimport { fetchAccessToken } from \"hume\"\n\nimport { VoiceProvider } from \"@humeai/voice-react\"\nimport { StartCall } from \"./_StartCall\"\n// import { canCreateInterview } from \"@/features/interviews/permissions\"\nimport { serverEnv } from \"@/data/env/server\"\n\n\nexport default async function NewInterviewPage({\n  params,\n}: {\n  params: Promise<{ jobInfoId: string }>\n}) {\n  const { jobInfoId } = await params\n  return (\n    <Suspense\n      fallback={\n        <div className=\"h-screen-header flex items-center justify-center\">\n          <Loader2Icon className=\"animate-spin size-24\" />\n        </div>\n      }\n    >\n      <SuspendedComponent jobInfoId={jobInfoId} />\n    </Suspense>\n  )\n}\n\nasync function SuspendedComponent({ jobInfoId }: { jobInfoId: string }) {\n  const { userId, redirectToSignIn, user } = await getCurrentUser({\n    allData: true,\n  })\n  if (userId == null || user == null) return redirectToSignIn()\n\n//   if (!(await canCreateInterview())) return redirect(\"/app/upgrade\")\n\n  const jobInfo = await getJobInfo(jobInfoId, userId)\n  if (jobInfo == null) return notFound()\n\n  const accessToken = await fetchAccessToken({\n    apiKey: serverEnv.HUME_API_KEY,\n    secretKey: serverEnv.HUME_SECRET_KEY,\n  })\n\n  return (\n    <VoiceProvider>\n      <StartCall jobInfo={jobInfo} user={user} accessToken={accessToken} />\n    </VoiceProvider>\n  )\n}\n\nasync function getJobInfo(id: string, userId: string) {\n  \"use cache\"\n  cacheTag(getJobInfoIdTag(id))\n\n  return db.query.JobInfoTable.findFirst({\n    where: and(eq(JobInfoTable.id, id), eq(JobInfoTable.userId, userId)),\n  })\n}"],"names":[],"mappings":";;;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA,yEAAyE;AACzE;;;;;;;;;;;;;;;;;;;;;;AAGe,eAAe,iBAAiB,EAC7C,MAAM,EAGP;IACC,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,qBACE,8OAAC,iNAAQ;QACP,wBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC,oOAAW;gBAAC,WAAU;;;;;;;;;;;kBAI3B,cAAA,8OAAC;YAAmB,WAAW;;;;;;;;;;;AAGrC;AAEA,eAAe,mBAAmB,EAAE,SAAS,EAAyB;IACpE,MAAM,EAAE,MAAM,EAAE,gBAAgB,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,0JAAc,EAAC;QAC9D,SAAS;IACX;IACA,IAAI,UAAU,QAAQ,QAAQ,MAAM,OAAO;IAE7C,uEAAuE;IAErE,MAAM,UAAU,MAAM,WAAW,WAAW;IAC5C,IAAI,WAAW,MAAM,OAAO,IAAA,iMAAQ;IAEpC,MAAM,cAAc,MAAM,IAAA,iJAAgB,EAAC;QACzC,QAAQ,yIAAS,CAAC,YAAY;QAC9B,WAAW,yIAAS,CAAC,eAAe;IACtC;IAEA,qBACE,8OAAC,6KAAa;kBACZ,cAAA,8OAAC,mMAAS;YAAC,SAAS;YAAS,MAAM;YAAM,aAAa;;;;;;;;;;;AAG5D;IAEA,6SAAA,eAAe,WAAW,EAAU,EAAE,MAAc;IAElD,IAAA,kLAAQ,EAAC,IAAA,yJAAe,EAAC;IAEzB,OAAO,0HAAE,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC;QACrC,OAAO,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,uJAAY,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,uJAAY,CAAC,MAAM,EAAE;IAC9D;AACF;;;;;;IAPe","debugId":null}}]
}